<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>搭建Docker镜像仓库Harbor | 洋溢的博客</title>
    <meta property="og:title" content="搭建Docker镜像仓库Harbor - 洋溢的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-07-14T18:31:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-07-14T18:31:00&#43;08:00'>
        
    <meta name="Keywords" content="Rust,Golang">
    <meta name="description" content="搭建Docker镜像仓库Harbor">
        
    <meta name="author" content="洋溢">
    <meta property="og:url" content="https://amesy.github.io/post/2018-07-14-Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93Harbor%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%85%8D%E7%BD%AE/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://amesy.github.io/">
                        洋溢的博客
                    </a>
                
                <p class="description">软件开发</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://amesy.github.io/">首页</a>
                    
                    <a  href="https://amesy.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://amesy.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#harbor介绍">Harbor介绍</a></li>
    <li><a href="#安装harbor">安装Harbor</a>
      <ul>
        <li><a href="#环境准备">环境准备</a></li>
        <li><a href="#开始安装">开始安装</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">搭建Docker镜像仓库Harbor</h1>
        </header>
        <date class="post-meta meta-date">
            2018年7月14日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/Docker'>Docker</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="harbor介绍">Harbor介绍</h2>
<p>Harbor是一个由VMware公司开源的企业级的Docker Registry管理项目。它是一个用于存储和分发Docker镜像的企业级Registry服务器，通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源Docker Distribution。作为一个企业级私有Registry服务器，Harbor提供了更好的性能和安全。提升用户使用Registry构建和运行环境传输镜像的效率。Harbor支持安装在多个Registry节点的镜像资源复制，镜像全部保存在私有Registry中， 确保数据和知识产权在公司内部网络中管控。另外，Harbor也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等。</p>
<ul>
<li><strong>基于角色的访问控制</strong> - 用户与Docker镜像仓库通过“项目”进行组织管理，一个用户可以对多个镜像仓库在同一命名空间（project）里有不同的权限。</li>
<li><strong>镜像复制</strong> - 镜像可以在多个Registry实例中复制(同步)。尤其适合于负载均衡，高可用，混合云和多云的场景。</li>
<li><strong>图形化用户界面</strong> - 用户可以通过浏览器来浏览，检索当前Docker镜像仓库，管理项目和命名空间。</li>
<li><strong>AD/LDAP 支持</strong> - Harbor可以集成企业内部已有的AD/LDAP，用于鉴权认证管理。</li>
<li><strong>审计管理</strong> - 所有针对镜像仓库的操作都可以被记录追溯，用于审计管理。</li>
<li><strong>国际化</strong> - 已拥有英文、中文、德文、日文和俄文的本地化版本。更多的语言将会添加进来。</li>
<li><strong>RESTful API</strong> - RESTful API 提供给管理员对于Harbor更多的操控, 使得与其它管理软件集成变得更容易。</li>
<li><strong>部署简单</strong> - 提供在线和离线两种安装工具， 也可以安装到vSphere平台(OVA方式)虚拟设备。</li>
</ul>
<h2 id="安装harbor">安装Harbor</h2>
<h3 id="环境准备">环境准备</h3>
<ul>
<li>CentOS：7.4</li>
<li>Docker：17.12.0-ce</li>
<li>Docker-compose： version 1.13.0</li>
<li>Harbor： version 1.1.2</li>
</ul>
<h3 id="开始安装">开始安装</h3>
<p><strong>1）安装Docker</strong></p>
<p>官网安装文档：<a href="https://docs.docker.com/install/linux/docker-ce/centos/">https://docs.docker.com/install/linux/docker-ce/centos/</a></p>
<p><strong>2）安装Docker-compose</strong></p>
<ul>
<li>下载指定版本的docker-compose</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -L https://github.com/docker/compose/releases/download/1.13.0/docker-compose-<span style="color:#d14">`</span>uname -s<span style="color:#d14">`</span>-<span style="color:#d14">`</span>uname -m<span style="color:#d14">`</span> &gt; /usr/local/bin/docker-compose
</code></pre></td></tr></table>
</div>
</div><ul>
<li>对二进制文件赋可执行权限</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo chmod +x /usr/local/bin/docker-compose
</code></pre></td></tr></table>
</div>
</div><ul>
<li>测试 <code>docker-compose</code> 是否安装成功</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker-compose --version
docker-compose version 1.13.0, build 1719ceb
</code></pre></td></tr></table>
</div>
</div><p><strong>3）Harbor服务搭建</strong></p>
<ul>
<li>下载安装包并解压缩</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ wget https://github.com/vmware/harbor/releases/download/v1.1.2/harbor-online-installer-v1.1.2.tgz
$ tar xvf harbor-online-installer-v1.1.2.tgz
</code></pre></td></tr></table>
</div>
</div><ul>
<li>解压缩之后，可以看到 <code>harbor.cfg</code> 就是Harbor的配置文件。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ls harbor
common docker-compose.yml   harbor.cfg  LICENSE  prepare
docker-compose.notary.yml  harbor_1_1_0_template  install.sh  NOTICE upgrade
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo vim harbor.cfg 

<span style="color:#998;font-style:italic">## Configuration file of Harbor</span>

<span style="color:#998;font-style:italic"># hostname设置访问地址，可以使用ip、域名，不可以设置为127.0.0.1或localhost。</span>
<span style="color:#008080">hostname</span> <span style="color:#000;font-weight:bold">=</span> 10.68.7.20

<span style="color:#998;font-style:italic"># 访问协议，默认是http，也可以设置https，如果设置https，则nginx ssl需要设置on</span>
<span style="color:#008080">ui_url_protocol</span> <span style="color:#000;font-weight:bold">=</span> http

<span style="color:#998;font-style:italic"># mysql数据库root用户默认密码root123，实际使用时修改下</span>
<span style="color:#008080">db_password</span> <span style="color:#000;font-weight:bold">=</span> root123

<span style="color:#008080">max_job_workers</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span> 
<span style="color:#008080">customize_crt</span> <span style="color:#000;font-weight:bold">=</span> on
<span style="color:#008080">ssl_cert</span> <span style="color:#000;font-weight:bold">=</span> /data/cert/server.crt
<span style="color:#008080">ssl_cert_key</span> <span style="color:#000;font-weight:bold">=</span> /data/cert/server.key
<span style="color:#008080">secretkey_path</span> <span style="color:#000;font-weight:bold">=</span> /data
<span style="color:#008080">admiral_url</span> <span style="color:#000;font-weight:bold">=</span> NA

<span style="color:#998;font-style:italic"># 邮件设置，发送重置密码邮件时使用</span>
<span style="color:#008080">email_identity</span> <span style="color:#000;font-weight:bold">=</span> 
<span style="color:#008080">email_server</span> <span style="color:#000;font-weight:bold">=</span> smtp.mydomain.com
<span style="color:#008080">email_server_port</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">25</span>
<span style="color:#008080">email_username</span> <span style="color:#000;font-weight:bold">=</span> sample_admin@mydomain.com
<span style="color:#008080">email_password</span> <span style="color:#000;font-weight:bold">=</span> abc
<span style="color:#008080">email_from</span> <span style="color:#000;font-weight:bold">=</span> admin &lt;sample_admin@mydomain.com&gt;
<span style="color:#008080">email_ssl</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>

<span style="color:#998;font-style:italic"># 启动Harbor后，管理员UI登录的密码，默认是Harbor12345</span>
<span style="color:#008080">harbor_admin_password</span> <span style="color:#000;font-weight:bold">=</span> Harbor12345

<span style="color:#998;font-style:italic"># 认证方式，这里支持多种认证方式，如LADP、本次存储、数据库认证。默认是db_auth，mysql数据库认证</span>
<span style="color:#008080">auth_mode</span> <span style="color:#000;font-weight:bold">=</span> db_auth

<span style="color:#998;font-style:italic"># LDAP认证时配置项</span>
<span style="color:#998;font-style:italic">#ldap_url = ldaps://ldap.mydomain.com</span>
<span style="color:#998;font-style:italic">#ldap_searchdn = uid=searchuser,ou=people,dc=mydomain,dc=com</span>
<span style="color:#998;font-style:italic">#ldap_search_pwd = password</span>
<span style="color:#998;font-style:italic">#ldap_basedn = ou=people,dc=mydomain,dc=com</span>
<span style="color:#998;font-style:italic">#ldap_filter = (objectClass=person)</span>
<span style="color:#998;font-style:italic">#ldap_uid = uid </span>
<span style="color:#998;font-style:italic">#ldap_scope = 3 </span>
<span style="color:#998;font-style:italic">#ldap_timeout = 5</span>

<span style="color:#998;font-style:italic"># 是否开启自注册</span>
<span style="color:#008080">self_registration</span> <span style="color:#000;font-weight:bold">=</span> on

<span style="color:#998;font-style:italic"># Token有效时间，默认30分钟</span>
<span style="color:#008080">token_expiration</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">30</span>

<span style="color:#998;font-style:italic"># 用户创建项目权限控制，默认是everyone（所有人），也可以设置为adminonly（只能管理员）</span>
<span style="color:#008080">project_creation_restriction</span> <span style="color:#000;font-weight:bold">=</span> everyone

<span style="color:#008080">verify_remote_cert</span> <span style="color:#000;font-weight:bold">=</span> on
</code></pre></td></tr></table>
</div>
</div><p><strong>4）启动 Harbor</strong></p>
<p>修改完配置文件后，在的当前目录执行<code>./install.sh</code>，Harbor服务就会根据当期目录下的<code>docker-compose.yml</code>开始下载依赖的镜像，检测并按照顺序依次启动各个服务。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ./install.sh

... 

✔ ----Harbor has been installed and started successfully.----

Now you should be able to visit the admin portal at http://10.68.7.20	. 
For more details, please visit https://github.com/vmware/harbor .
</code></pre></td></tr></table>
</div>
</div><p><strong>Harbor依赖的镜像及启动服务如下：</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker images
REPOSITORY TAG   IMAGE ID CREATED  SIZE
hello-world   latest   f2a91732366c   <span style="color:#099">7</span> months ago   1.85kB
vmware/harbor-jobservice  v1.1.2   4ef0a7a33734   <span style="color:#099">13</span> months ago  163MB
vmware/harbor-ui v1.1.2   4ee8f190f366   <span style="color:#099">13</span> months ago  183MB
vmware/harbor-adminserver v1.1.2   cdcf1bed7eb4   <span style="color:#099">13</span> months ago  142MB
vmware/harbor-db v1.1.2   fcb8aa7a0640   <span style="color:#099">13</span> months ago  329MB
vmware/registry  2.6.1-photon   0f6c96580032   <span style="color:#099">14</span> months ago  150MB
vmware/nginx  1.11.5-patched 8ddadb143133   <span style="color:#099">15</span> months ago  199MB
vmware/harbor-log   v1.1.2   9c46a7b5e517   <span style="color:#099">16</span> months ago  192MB

$ docker-compose ps
  Name Command State   Ports  
------------------------------------------------------------------------------------------------------------------------------
harbor-adminserver /harbor/harbor_adminserver  Up   
harbor-db docker-entrypoint.sh mysqld Up 3306/tcp 
harbor-jobservice  /harbor/harbor_jobservice   Up   
harbor-log   /bin/sh -c crond <span style="color:#000;font-weight:bold">&amp;&amp;</span> rm -f  ... Up 127.0.0.1:1514-&gt;514/tcp 
harbor-ui /harbor/harbor_ui  Up   
nginx  nginx -g daemon off;  Up 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp, 0.0.0.0:80-&gt;80/tcp 
registry  /entrypoint.sh serve /etc/ ... Up 5000/tcp 
</code></pre></td></tr></table>
</div>
</div><p>启动完成后，通过访问配置文件设置的 hostname <a href="http://10.68.7.20/">http://10.68.7.20/</a>，默认是80端口。如果端口占用，可以去修改 <code>docker-compose.yml</code>文件中对应服务的端口映射，然后再次执行 <code>./install.sh</code> 即可。</p>
<p>如修改端口映射为本地的81端口对应容器的80端口：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vim docker-compose.yml 
...
ports:
  - 81:80
  - 443:443
  - 4443:4443
</code></pre></td></tr></table>
</div>
</div><p>然后再次执行 <code>./install.sh</code>：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./install.sh
</code></pre></td></tr></table>
</div>
</div><p>然后执行 <code>docker-compose ps</code> 就可以看到相关映射端口的信息。</p>
<p><strong>浏览器访问：</strong></p>
<p>注：更改或清空防火墙规则，否则访问时会报405错误。</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img01.png">
            <img class="mx-auto" alt="img01" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img01.png" />
        </a>
    </p>
<h1 id="登录-web-harbor">登录 Web Harbor</h1>
<p>用户名为 <code>admin</code>， 密码为 <code>docker-compose.cfg</code> 中 admin 对应的密码。</p>
<p>登录完后界面如下图所示：</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img02.png">
            <img class="mx-auto" alt="img02" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img02.png" />
        </a>
    </p>
<p>可以看到系统各个模块如下:</p>
<ul>
<li>项目：新增/删除项目，查看镜像仓库，给项目添加成员、查看操作日志、复制项目等。</li>
<li>日志：仓库各个镜像create、push、pull等操作日志。</li>
<li>系统管理
<ol>
<li>用户管理：新增/删除用户、设置管理员等</li>
<li>复制管理：新增/删除从库目标、新建/删除/启停复制规则等</li>
<li>配置管理：认证模式、复制、邮箱设置、系统设置等</li>
</ol>
</li>
<li>其他设置
<ol>
<li>用户设置：修改用户名、邮箱、名称信息</li>
<li>修改密码：修改用户密码</li>
</ol>
</li>
</ul>
<p>注：非系统管理员用户登录，只能看到有权限的项目和日志，其他模块不可见。</p>
<h1 id="新建项目">新建项目</h1>
<p>新建一个项目，可以选择设置项目为公开或不公开。此处我创建了两个仓库，一个私有仓库和一个公开仓库：</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img03.png">
            <img class="mx-auto" alt="img03" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img03.png" />
        </a>
    </p>
<p>注意：当项目设为公开后，任何人都有此项目下镜像的读权限。命令行用户不需要 <code>docker login</code> 就可以拉取此项目下的镜像。</p>
<p>新建项目完毕后，我们就可以用admin账户提交本地镜像到Harbor仓库了。例如提交本地nginx镜像：</p>
<p>注：此处容器映射端口由 <code>81</code> 换回 <code>80</code> 。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># 1、admin登录 </span>
$ docker login 10.68.7.20
Username <span style="color:#000;font-weight:bold">(</span>admin<span style="color:#000;font-weight:bold">)</span>: admin
Password: 
Login Succeeded

<span style="color:#998;font-style:italic"># 2、给镜像打tag </span>
$ docker tag nginx 10.68.7.20/docker_private/nginx:latest
$ docker images
REPOSITORY TAG   IMAGE ID CREATED  SIZE
10.68.7.20/docker_private/nginx latest   e548f1a579cf   <span style="color:#099">4</span> months ago   109MB
nginx   latest   e548f1a579cf   <span style="color:#099">4</span> months ago   109MB

<span style="color:#998;font-style:italic"># 3、push到仓库 </span>
$ docker push 10.68.7.20/docker_private/nginx
The push refers to repository <span style="color:#000;font-weight:bold">[</span>10.68.7.20/docker_private/nginx<span style="color:#000;font-weight:bold">]</span>
e89b70d28795: Pushed 
832a3ae4ac84: Pushed 
014cf8bfcb2d: Pushed 
latest: digest: sha256:600bff7fb36d7992512f8c07abd50aac08db8f17c94e3c83e47d53435a1a6f7c size: <span style="color:#099">948</span>
</code></pre></td></tr></table>
</div>
</div><p>注：此处第一步，执行本地登录操作可能会报错：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker login 10.68.7.20
Username: admin
Password: 
Error response from daemon: Get https://10.68.7.20/v2/: <span style="color:#0086b3">read</span> tcp 10.68.7.20:34348-&gt;10.68.7.20:443: read: connection reset by peer
</code></pre></td></tr></table>
</div>
</div><p>解决办法：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ vim /etc/docker/daemon.json 
<span style="color:#998;font-style:italic"># 添加该行。</span>
<span style="color:#000;font-weight:bold">{</span> <span style="color:#d14">&#34;insecure-registries&#34;</span>:<span style="color:#000;font-weight:bold">[</span><span style="color:#d14">&#34;10.68.7.20&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后重启 docker 服务即可。</p>
<p>CentOS或Ubuntu系统均可采用该方法解决。</p>
<p>上传完毕后，登录Web Harbor，选择对应项目名称 docker_private，就可以查看到刚才上传的 nginx image。</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img04.png">
            <img class="mx-auto" alt="img04" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img04.png" />
        </a>
    </p>
<h1 id="创建用户并分配权限">创建用户并分配权限</h1>
<p>我们刚一直是用 <code>admin</code> 操作，实际应用中我们使用每个人自己的账户登录。所以就需要新建用户，同时为了让用户有权限操作已经创建的项目，还必须将该用户添加到所属项目成员中。</p>
<p>创建用户名为 amesy 的测试用户，点击系统管理 -&gt;用户管理 -&gt; 创建用户，输入用户名、邮箱、密码等信息。</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img05.png">
            <img class="mx-auto" alt="img05" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img05.png" />
        </a>
    </p>
<p>将 amesy 用户添加到 docker_private 项目成员中，点击项目 -&gt; docker_private -&gt; 成员 -&gt; 新建成员，填写姓名，选择角色。</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img06.png">
            <img class="mx-auto" alt="img06" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img06.png" />
        </a>
    </p>
<p>现在我们使用 amesy 账户在本地模拟操作 pull 刚上传的nginx镜像。</p>
<p><strong>1、先移除tag</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker rmi -f e548f1a579cf
Untagged: 10.68.7.20/docker_private/nginx:latest
Untagged: 10.68.7.20/docker_private/nginx@sha256:600bff7fb36d7992512f8c07abd50aac08db8f17c94e3c83e47d53435a1a6f7c
Untagged: nginx:latest
Untagged: nginx@sha256:4771d09578c7c6a65299e110b3ee1c0a2592f5ea2618d23e4ffe7a4cab1ce5de
Deleted: sha256:e548f1a579cf529320a3c1d8789399e5fea0bfaa04cbb70d03890afafb748a2f
Deleted: sha256:8a75dc522d5a065b4cb16e88a34bbaf263b556e6b391def1f0e1d0570f304846
Deleted: sha256:9fd6be84ea2038d2a8c3d8bd369b2b51a4a19cb14af4ee7ac5dedd1e702d0b9c
Deleted: sha256:014cf8bfcb2d50b7b519c4714ac716cda5b660eae34189593ad880dc72ba4526
</code></pre></td></tr></table>
</div>
</div><p><strong>2、退出 admin 账号，使用 amesy 账户登录</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker <span style="color:#0086b3">logout</span> 10.68.7.20
Removing login credentials <span style="color:#000;font-weight:bold">for</span> 10.68.7.20
$ docker login 10.68.7.20
Username: amesy
Password: 
Login Succeeded
</code></pre></td></tr></table>
</div>
</div><p><strong>3、pull 相应镜像到本地</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># docker pull 10.68.7.20/docker_private/nginx:latest</span>
latest: Pulling from docker_private/nginx
8176e34d5d92: Pull <span style="color:#0086b3">complete</span> 
5b19c1bdd74b: Pull <span style="color:#0086b3">complete</span> 
4e9f6296fa34: Pull <span style="color:#0086b3">complete</span> 
Digest: sha256:600bff7fb36d7992512f8c07abd50aac08db8f17c94e3c83e47d53435a1a6f7c
Status: Downloaded newer image <span style="color:#000;font-weight:bold">for</span> 10.68.7.20/docker_private/nginx:latest
</code></pre></td></tr></table>
</div>
</div><p>此时，通过 <code>docker images</code> 命令就可以查看到 pull 到本地的镜像。</p>
<h1 id="配置-docker-镜像复制">配置 Docker 镜像复制</h1>
<p>首先提供至少两台Harbor服务：</p>
<p>Harbor1：10.68.7.20</p>
<p>Harbor2：10.68.7.30</p>
<p>之前的操作已经往Harbor1上面push了一个镜像，那么就把Harbor1当做主节点，Harbor2当做复制节点，我们要把Harbor1上的镜像自动复制到Harbor2上去。</p>
<p><strong>配置复制规则</strong></p>
<p>点击项目 -&gt; docker_private -&gt; 复制 -&gt; 新建复制规则，填写名称、目标名、目标URL等信息。</p>
<p>注：目标URL这里指Harbor2的地址，用户名和密码为Harbor2配置的admin账户和密码，一旦勾选启用，那么新建复制规则完成后，立马就会检测需要同步的image自动同步。</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img07.png">
            <img class="mx-auto" alt="img07" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img07.png" />
        </a>
    </p>
<p>然后查看Harbor2节点信息，可以看到数据镜像已同步完成，对应的日志信息等也已生成。</p>
<p>
        <a data-fancybox="gallery" href="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img08.png">
            <img class="mx-auto" alt="img08" src="https://github.com/amesy/amesy.github.io/blob/master/pictures/2018/Harbor/img08.png" />
        </a>
    </p>
<p>之后，因为配置了复制规则的缘故，Harbor1的 docker_private 项目下有新的镜像生成，就会自动同步到 Harbor2 的 docker_private 项目下。</p>
<p>参考文档：</p>
<ul>
<li><a href="https://vmware.github.io/harbor/cn/">https://vmware.github.io/harbor/cn/</a></li>
<li><a href="https://github.com/vmware/harbor/">https://github.com/vmware/harbor/</a></li>
</ul>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://amesy.github.io/">洋溢</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://amesy.github.io/post/2018-07-14-Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93Harbor%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%85%8D%E7%BD%AE/">https://amesy.github.io/post/2018-07-14-Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93Harbor%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%85%8D%E7%BD%AE/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/about/">关于我</a></li>
        
        <li><a href="/archives/">归档</a></li>
        
        <li><a href="/search/">搜索</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Docker'>Docker</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2022 <a href="https://amesy.github.io/">洋溢的博客 By 洋溢</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdn.bootcdn.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://amesy.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://amesy.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://amesy.github.io/post/2018-07-14-Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93Harbor%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%85%8D%E7%BD%AE/" title="搭建Docker镜像仓库Harbor">搭建Docker镜像仓库Harbor</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://amesy.github.io/categories/Docker/">Docker (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://amesy.github.io/tags/Docker/">Docker</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.amesy.github.io/" title="洋溢的博客">洋溢的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://amesy.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>